<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Temat forum</title>
  <link rel="stylesheet" th:href="@{/css/styles.css}" />
</head>
<body>
<header>
  <div class="container">
    <a th:href="@{/forum}" style="color:white; text-decoration:none; font-weight:700;">← Powrót do forum</a>
    <h1 style="margin-top: 10px;">Temat</h1>
  </div>
</header>

<main class="container">
  <section>
    <div th:if="${session.user == null}">
      <p>Musisz być <a th:href="@{/forum/login}">zalogowany</a>, aby dodawać posty i usuwać je.</p>
    </div>

    <div th:if="${successMessage}" style="color: green; margin-bottom: 15px; font-weight: bold;">
      <p th:text="${successMessage}"></p>
    </div>
    <div th:if="${errorMessage}" style="color: red; margin-bottom: 15px; font-weight: bold;">
      <p th:text="${errorMessage}"></p>
    </div>

    <div th:if="${session.user != null}">
      <form th:action="@{/forum/post}" method="post" style="margin-bottom: 20px;">
        <input type="hidden" name="topicId" th:value="${topicId}" />
        <textarea name="content" placeholder="Dodaj post..." required
                  style="width: 100%; min-height: 100px; padding: 10px; border: 1px solid #ccc; border-radius: 5px; resize: vertical;"></textarea>
        <button type="submit" style="margin-top: 10px;">Dodaj post</button>
      </form>
    </div>

    <ul style="list-style: none; padding: 0;">
      <li th:each="post : ${posts}"
          style="background: white; box-shadow: 0 1px 3px rgba(0,0,0,0.1); padding: 15px; margin-bottom: 15px; border-radius: 6px; position: relative;">

        <p th:text="${post.content}" style="white-space: pre-wrap; font-size: 1rem; margin-bottom: 10px;"></p>

        <div th:if="${session.user != null and (session.user.role == 'ADMIN' or session.user.role == 'MODERATOR' or session.user.id == post.author.id)}"
             style="position: absolute; top: 15px; right: 15px;">
          <form th:action="@{/forum/post/delete}" method="post" onsubmit="return confirm('Na pewno usunąć ten post?');" style="margin: 0;">
            <input type="hidden" name="postId" th:value="${post.id}" />
            <input type="hidden" name="topicId" th:value="${topicId}" />
            <button type="submit" style="background-color:#dc3545; padding: 6px 10px; font-size: 0.85rem;">Usuń</button>
          </form>
        </div>
      </li>
    </ul>
  </section>
</main>

<footer>
  <div class="container">
    &copy; 2025 Twoje Forum • Wszelkie prawa zastrzeżone.
  </div>
</footer>
</body>
</html>
